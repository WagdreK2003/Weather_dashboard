<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

:root {
  --background-dark: #121212;
  --card-dark: rgba(255, 255, 255, 0.05);
  --border-dark: rgba(255, 255, 255, 0.1);
  --text-light: #e0e0e0;
  --text-primary: #8e24aa;
  --text-secondary: #bdbdbd;
  --accent-color: #8e24aa;
  --accent-light: #ab47bc;
  --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  --backdrop-blur: blur(10px);
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--background-dark);
  color: var(--text-light);
  transition: background-image 0.5s ease-in-out;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  max-width: 900px;
  padding: 2.5rem;
  background: var(--card-dark);
  border-radius: 20px;
  box-shadow: var(--card-shadow);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border: 1px solid var(--border-dark);
  animation: fadeIn 1s ease-in-out;
}

h1 {
  font-weight: 600;
  color: var(--text-primary);
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.btn {
  border-radius: 50px;
  font-weight: 500;
  padding: 0.75rem 1.5rem;
  transition: all 0.3s ease;
}

.btn-primary {
  background-color: var(--accent-color);
  border-color: var(--accent-color);
}

.btn-primary:hover {
  background-color: var(--accent-light);
  border-color: var(--accent-light);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.btn-secondary {
  background-color: #6a1b9a;
  border-color: #6a1b9a;
}

.btn-secondary:hover {
  background-color: #8e24aa;
  border-color: #8e24aa;
}

.form-control {
  border-radius: 50px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid var(--border-dark);
  color: var(--text-light);
  transition: all 0.3s ease;
}

.form-control::placeholder {
  color: var(--text-secondary);
}

.form-control:focus {
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 0.25rem rgba(142, 36, 170, 0.25);
  border-color: var(--accent-color);
}

.weather-container {
  margin-top: 2rem;
}

.city-card {
  padding: 2rem;
  border-radius: 15px;
  background: var(--card-dark);
  box-shadow: var(--card-shadow);
  backdrop-filter: var(--backdrop-blur);
  border: 1px solid var(--border-dark);
  margin-bottom: 1.5rem;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  overflow: hidden;
}

.city-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
}

.city-card h4 {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.city-card h5 {
  color: var(--text-light);
}

.dashboard-scrollbar {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 15px;
}

.dashboard-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.dashboard-scrollbar::-webkit-scrollbar-thumb {
  background-color: var(--accent-color);
  border-radius: 10px;
}

.dashboard-scrollbar::-webkit-scrollbar-track {
  background-color: transparent;
}

.alert {
  border-radius: 10px;
  font-weight: 500;
}

.alert-danger {
  background-color: rgba(220, 53, 69, 0.1);
  border-color: rgba(220, 53, 69, 0.3);
  color: #dc3545;
}

.alert-warning {
  background-color: rgba(255, 193, 7, 0.1);
  border-color: rgba(255, 193, 7, 0.3);
  color: #ffc107;
}

.alert-success {
  background-color: rgba(40, 167, 69, 0.1);
  border-color: rgba(40, 167, 69, 0.3);
  color: #28a745;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

.toggle-btn {
  animation: pulse 2s infinite;
}
   
  </style>
</head>
<body>
  <div class="ball"></div>
</body>
</html>

  </style>
</head>
<body>
  <div class="container">
    <div class="text-center mt-4">
      <h1 class="fw-bold text-primary">üå¶Ô∏è Weather Dashboard</h1>
      <button class="btn btn-secondary toggle-btn" onclick="toggleView()">Toggle View</button>
    </div>

    <!-- Weather Search Section -->
    <div id="searchSection" class="weather-container">
      <form id="weatherForm" class="d-flex mb-3">
        <input type="text" class="form-control me-2" id="cityInput" placeholder="Enter city" required />
        <button type="submit" class="btn btn-primary">Get Weather</button>
      </form>
      <div id="weatherResult" class="text-center"></div>
    </div>

    <!-- Saved Weather Records Section -->
    <div id="dashboardSection" class="weather-container" style="display:none">
      <h3 class="fw-bold text-primary mb-3">üìã Saved Weather Records</h3>
      <div class="dashboard-scrollbar" id="savedRecords"></div>
    </div>
  </div>

  <script>
    
    const form = document.getElementById('weatherForm');
    const cityInput = document.getElementById('cityInput');
    const weatherResult = document.getElementById('weatherResult');
    const savedRecords = document.getElementById('savedRecords');
    const searchSection = document.getElementById('searchSection');
    const dashboardSection = document.getElementById('dashboardSection');

    function toggleView() {
      if (searchSection.style.display === 'none') {
        searchSection.style.display = 'block';
        dashboardSection.style.display = 'none';
      } else {
        searchSection.style.display = 'none';
        dashboardSection.style.display = 'block';
        fetchSavedWeather();
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const city = cityInput.value.trim();
      if (!city) return;

      try {
        // Updated route to match routes.js: GET /weather/:city
        const res = await fetch(`/weather/${city}`);
        const data = await res.json();

        if (data.error) {
          weatherResult.innerHTML = `<div class="alert alert-danger">‚ùå ${data.error}</div>`;
        } else {
          const temp = data.main.temp;
          const condition = data.weather[0].main;
          document.body.style.backgroundImage = `url('assets/images/${getBackgroundImage(condition)}')`;

          weatherResult.innerHTML = `
            <div class="city-card text-center">
              <h4>üåç ${city.toUpperCase()}</h4>
              <h5>üå°Ô∏è ${temp}¬∞C</h5>
              <p>üå§Ô∏è ${condition}</p>
              <button onclick="saveWeather('${city}', ${temp}, '${condition}')" class="btn btn-success mt-2">Save Weather</button>
            </div>`;
        }
      } catch (err) {
        weatherResult.innerHTML = `<div class="alert alert-danger">‚ùå Server Error. Please check the city name and server status.</div>`;
      }
    });

    function getBackgroundImage(condition) {
      const weatherMap = {
        Clear: 'sunny.jpg',
        Clouds: 'cloudy.jpg',
        Rain: 'rainy.jpg',
        Drizzle: 'rainy.jpg',
        Thunderstorm: 'storm.jpg',
        Snow: 'snow.jpg',
        Mist: 'foggy.jpg',
        Fog: 'foggy.jpg',
        Haze: 'foggy.jpg'
      };
      return weatherMap[condition] || 'default.jpg';
    }

    async function saveWeather(city, temp, condition) {
      try {
        // Updated route to match routes.js: POST /api/weather
        await fetch('/api/weather', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ city, temp, condition })
        });
        alert('‚úÖ Weather saved!');
      } catch {
        alert('‚ùå Failed to save weather');
      }
    }

    async function fetchSavedWeather() {
  try {
    const res = await fetch('/all');
    const data = await res.json();

    if (Array.isArray(data) && data.length > 0) {
      savedRecords.innerHTML = data.map(entry => `
        <div class="city-card">
          üìç <strong>${entry.city}</strong><br>
          üå°Ô∏è ${entry.temperature}¬∞C<br>
          üå§Ô∏è ${entry.description}<br>
          üïí ${new Date(entry.searchedAt).toLocaleString()}
        </div>
      `).join('');
    } else {
      savedRecords.innerHTML = `<div class="alert alert-warning">No records found.</div>`;
    }
  } catch (err) {
    savedRecords.innerHTML = `<div class="alert alert-danger">Failed to load records</div>`;
  }
}

  </script>
</body>
</html>
